{% extends "base.html" %}
{% block head_title %}{{ user.username }} | {{ block.super }}{% endblock head_title %}

{% block content %}

<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top border border-bottom-1 mb-5">
  <ul class="nav navbar-nav navbar-logo mx-auto">
    <li class="nav-item">
      <a class="text-dark nav-link" href="#"><b>{{ user }}</b></a>
    </li>
  </ul>
</nav>
<div class="container">
  <div class="row mt-5">
    <div class="col-3 col-md-4">
      <!--mobile-responsive-->
      {% if user.profile.photo %}
      <img class="d-block d-sm-none mr-auto mb-4 rounded-circle img-fluid" alt="Responsive image" src="{{ user.profile.photo.url }}" style="width: 80px; height: 80px;"/>
      {% else %}
      <img class="d-block d-sm-none mx-auto mb-4 border border-dark shadow rounded-circle img-fluid" src="http://placehold.it/250x250" style="width: 80px; height: 80px;"/>
      {% endif %}
      <!--desktop-responsive-->
      {% if user.profile.photo %}
      <img class="d-none d-sm-block mx-auto mb-4 rounded-circle img-fluid" alt="Responsive image" src="{{ user.profile.photo.url }}" style="width: 160px; height: 160px;"/>
      {% else %}
      <img class="d-none d-sm-block mx-auto mb-4 border border-dark shadow rounded-circle img-fluid" src="http://placehold.it/250x250" style="width: 160px; height: 160px;"/>
      {% endif %}
      {% with total_followers=user.followers.count %}
      {% with total_following=user.following.count %}
    </div>
    <div class="col-6 col-md-4 mb-4">
      <!--mobile-responsive-->
      <h3 class="d-block d-sm-none text-center">{{ user.username }}</h3>
      {% if request.user.profile.id == user.profile.id %}
      <a class="d-block d-sm-none btn btn-block btn-sm btn-outline-dark mx-auto" href="{% url 'accounts:update' %}">
        <b>Edit Profile</b>
      </a>
      {% endif %}
      <!--desktop-responsive-->
      {% if request.user.profile.id != user.profile.id %}
      <a href="#" data-id="{{ user.id }}" data-action="{% if request.user in user.followers.all %}un{% endif %}follow" class="w-25 float-right follow my-auto btn btn-sm btn-block btn-info d-none d-sm-block">
        {% if request.user not in user.followers.all %}
          Follow
        {% else %}
          Unfollow
        {% endif %}
      </a>
      {% endif %}
      <h1 class="d-none d-sm-block text-left">{{ user.username }}</h1>
      {% if request.user.profile.id == user.profile.id %}
      <a class="w-40 my-auto btn btn-sm btn-block btn-outline-secondary d-none d-sm-block" href="{% url 'accounts:update' %}">
        <b>Edit Profile</b>
      </a>
      {% endif %}
      
    
      <span class="d-none d-sm-block">
        {% include "partials/accounts/profile_horizontal_list.html" %}
      </span>
      <p class="d-none d-sm-block text-left"><b>{{ user.first_name }}</b></p>
      <p class="d-none d-sm-block text-left mt-n3">{{ user.profile.bio }}</p>
      
    </div>
  </div> <!--/.row-->
  <div class="row d-block d-sm-none">
    <div class="col">
      <p class="text-left"><b>{{ user.first_name }}</b></p>
      <p class="text-left mt-n3">{{ user.profile.bio }}</p>
    </div>
  </div>
  {% if request.user.profile.id != user.profile.id %}
      <a href="#" data-id="{{ user.id }}" data-action="{% if request.user in user.followers.all %}un{% endif %}follow" class="follow mb-4 mt-3 mx-auto btn btn-block btn-info d-block d-sm-none">
        {% if request.user not in user.followers.all %}
          Follow
        {% else %}
          Unfollow
        {% endif %}
      </a>
      {% endif %}
  <span class="d-block d-sm-none">
    {% include "partials/accounts/profile_horizontal_list.html" %}
  </span>

  <ul class="nav nav-fill nav-pills mb-3" id="pills-tab" role="tablist">
    <li class="nav-item">
      <i class="fas fa-th nav-link active" id="pills-reviews-tab" data-toggle="pill" href="#pills-reviews" role="tab" aria-controls="pills-reviews" aria-selected="true"></i>
    </li>
    <li class="nav-item">
      <i class="nav-link fas fa-heart" id="pills-favs-tab" data-toggle="pill" href="#pills-favs" role="tab" aria-controls="pills-favs" aria-selected="false"></i>
    </li>
  </ul>

  <div class="tab-content" id="pills-tabContent">
    <div class="tab-pane show fade active" id="pills-reviews" role="tabpanel" aria-labelledby="pills-reviews-tab">
      {% include "accounts/profile_user_reviews.html" %}
    </div>
    <div class="tab-pane fade" id="pills-favs" role="tabpanel" aria-labelledby="pills-favs-tab">
      {% include "accounts/profile_user_favorites.html" %}
    </div>
  </div> <!--/.tab-content-->
</div> <!--/.container-->

<style>
i.nav-link.active {
  background-color: black !important;
}
</style>

{% include "partials/followers.html" %}
{% include "partials/following.html" %}


{% endwith %}
{% endwith %}

{% endblock %}

{% block domready %}
  $('a.follow').click(function(e){
    e.preventDefault();
    $.post('{% url "accounts:user_follow" %}',
    {
      id: $(this).data('id'),
      action: $(this).data('action')
    },
    function(data){
      if (data['status'] == 'ok') {
        var previous_action = $('a.follow').data('action');

        $('a.follow').data('action', previous_action == 'follow' ? 'unfollow' : 'follow');
        $('a.follow').text(previous_action == 'follow' ? 'Unfollow' : 'Follow');

        var previous_followers = parseInt($('total-followers').text());
        $('total-followers').text(previous_action == 'follow' ? previous_followers + 1 : previous_followers -1);
      }
    }
    );
  });
{% endblock %}

{% extends "base.html" %}
{% block head_title %} Latest Reviews | {{ block.super }}{% endblock head_title %}
{% block content %}


{% include 'partials/nav_header.html' %}

<div id="reviewCardContainer" class="container">
  <div class="row justify-content-center align-items-center">
    <div id="reviewList" class="col-12 col-md-6 p-0">
      <h2 style="font-weight: 600;" class="mt-3 text-left">Latest Reviews</h2>
      {% include 'messages_display.html' %}
      {% include "partials/reviews/review_copy_link_notification.html" %}
      {% include "partials/reviews/review_card.html" %}
    </div> <!--/.col-12.p-0-->
  </div> <!--/.row-->
</div> <!--/.container-->


<style>
  body {
    background-color: #f8f9fa;
  }
  #myAlert {
    width: inherit;
    position: fixed;
    bottom: 10%;
    background-color: #23ce6b; 
    border: #6eb257 !important; 
    color: #FFF; 
    font-weight: 500;
    z-index: 9999; 
    visibility: hidden;	
    opacity: 0;
    -webkit-transition: all .15s ease-in;
       -moz-transition: all .15s ease-in;
         -o-transition: all .15s ease-in;
            transition: all .15s ease-in;
  }
  #myAlert.target {
    visibility: visible;
    opacity: 1;
    transform: translateY(50px);
  }

  .pulsate-fwd {
	-webkit-animation: pulsate-fwd 0.5s ease-in-out both;
	        animation: pulsate-fwd 0.5s ease-in-out both;
}
/* ----------------------------------------------
 * Generated by Animista on 2021-7-22 21:30:42
 * Licensed under FreeBSD License.
 * See http://animista.net/license for more info. 
 * w: http://animista.net, t: @cssanimista
 * ---------------------------------------------- */

/**
 * ----------------------------------------
 * animation pulsate-fwd
 * ----------------------------------------
 */
 @-webkit-keyframes pulsate-fwd {
  0% {
    -webkit-transform: scale(1);
            transform: scale(1);
  }
  50% {
    -webkit-transform: scale(1.2);
            transform: scale(1.2);
  }
  100% {
    -webkit-transform: scale(1);
            transform: scale(1);
  }
}
@keyframes pulsate-fwd {
  0% {
    -webkit-transform: scale(1);
            transform: scale(1);
  }
  50% {
    -webkit-transform: scale(1.2);
            transform: scale(1.2);
  }
  100% {
    -webkit-transform: scale(1);
            transform: scale(1);
  }
}


</style>


{% endblock %}
{% block domready %}

document.getElementById('copyLink').addEventListener('click', e => {
  e.preventDefault();
  navigator.clipboard.writeText(e.target.href).then(() => {
    /* clipboard successfully set */
    console.log('set');
  }, () => {
    /* clipboard write failed */
    console.log('failed');
  });

  document.getElementById('myAlert').classList.toggle('target');
  document.getElementById('exampleModal1').classList.toggle('hide');
  
  $('#exampleModal1').modal('hide')

  setTimeout(() => {
    document.getElementById('myAlert').classList.toggle('target'); 
  }, 3000);
});

$('#exampleModal').modal('hide');

$('#reviewList').click(function(e){
  
  if (e.target.parentElement.className == 'review-like') {
    e.preventDefault();
    const anchor = e.target.parentElement;
    $.post('{% url "reviews:review_like" %}',
    {
      id: $(anchor).data('id'),
      action: $(anchor).data('action')
    },
    function(data){
      if (data['status'] == 'ok')
      {
        var previous_action = $(anchor).data('action');
        // toggle data-action
        $(anchor).data('action', previous_action == 'like' ? 'unlike' : 'like');
        // toggle heart icon
        $(anchor).html(previous_action == 'like' ? 
        `<i style="color: #6eb257;" class="mt-1 fas fa-heart pulsate-fwd"></i>` : 
        `<i style="color: black;" class="mt-1 far fa-heart pulsate-fwd"></i>`);
        // update total likes
        var previous_likes = parseInt($('span.count .total').text());
        $('span.count .total').text(previous_action == 'like' ? previous_likes + 1 : previous_likes - 1);
      
  }})};
  });

document.getElementById('reviewCardContainer').addEventListener('click', function(event){
  const anchor = event.target;
  if (anchor.className === 'show-link') {
    event.preventDefault();
    const less = event.target.parentNode.firstElementChild.nextElementSibling;
    const dots = less.firstElementChild;
    const more = less.nextElementSibling;
    if (dots.style.display === 'inline') {
      less.style.display = 'none';
      dots.style.display = 'none';
      more.style.display = 'inline';
      anchor.style.display = 'none';
    };
  };
  });

var page = 1;
var empty_page = false;
var block_request = false;

$(window).scroll(function() {
  var margin = $(document).height() - $(window).height() - 200;
  if  ($(window).scrollTop() > margin && empty_page == false && block_request == false){
    block_request = true;
    page += 1;
    $.get('?page=' + page, function(data) {
      if(data == '') {
        empty_page = true;
      } else {
        block_request = false;
        $('#reviewList').append(data);
      }
         });
       }
     });
{% endblock %}

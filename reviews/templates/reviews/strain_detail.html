
{% extends "base.html" %}
{% block head_title %}{{ strain.name }} | {{ block.super }}{% endblock head_title %}
{% load split_lists %}
{% block content %}

{% include 'partials/nav_header.html' %}

{% include "messages_display.html" %}

<div style="padding-top: 100px;" class="container">
  <div class="row">
    <!-- strain photo -->
    <div class="col-sm-6 mb-4">
      {% include 'partials/strains/strain_like_button.html' %}
      <h2 style="font-weight: 500;" class="text-left">{{ strain }}</h2>
      {% include "partials/strains/strain_detail_photo.html" %}
    </div> <!--/.col-sm-6-->
    <!-- strain details -->
    <div class="col-sm-6">
      {% include "partials/strains/strain_detail_rating.html" %}
      {% with count=strain.user_review.all.count %}
      {% if count > 0 %}
      {% include 'partials/reviews/review_count.html' %}
      {% endif %}
      {% endwith %}
      {% if strain.lineage %}
      <hr/>
      {% include "partials/strains/strain_detail_lineage.html" %}
      {% endif %}
    </div> <!--/.col-sm-6-->
  </div> <!--/.row-->
<!-- strain summary from leafly.com -->
  <div class="row">
    <div class="col-12">
      {% include 'partials/strains/strain_detail_summary.html' %}
    </div>
  </div>
  {% include "partials/reviews/review_user_submissions.html" %}
</div>


<style>
  div.alert {
    margin-top: 50px;
  }
</style>

{% endblock %}


{% block domready %}


const strainRating = {{ strain.get_average_rating }}


$(".my-rating").starRating({
  initialRating: strainRating,
  readOnly: true,
  totalStars: 5,
  starShape: 'rounded',
  starSize: 20,
  emptyColor: 'lightgray',
  hoverColor: 'salmon',
  activeColor: '#0D2818',
  useGradient: false
});


$('a.strain-like').click(function(e){
  e.preventDefault();
  console.log('hello');
  $.post('{% url "reviews:strain_like" %}',
{
  id: $(this).data('id'),
  action: $(this).data('action')
},
  function(data){
    if (data['status'] == 'ok')
  {
    var previous_action = $('a.strain-like').data('action');
    // toggle data-action
    $('a.strain-like').data('action', previous_action == 'like' ? 'unlike' : 'like');
    // toggle heart icon
    $('a.strain-like').html(previous_action == 'like' ? 
    `<i style="position: relative; left: 8px; top: 7px; color: #23CE6B;" class="fas fa-heart"></i>` : 
    `<i style="position: relative; left: 8px; top: 7px; color: #23CE6B;" class="far fa-heart"></i>`);
    // update total likes
    var previous_likes = parseInt($('span.count .total').text());
    $('span.count .total').text(previous_action == 'like' ? previous_likes + 1 : previous_likes - 1);
  }});
});

{% endblock %}
